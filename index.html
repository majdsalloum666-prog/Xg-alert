<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>xG Alert (Live)</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding-top: 20px;
    }

    #enableSoundBtn {
      font-size: 18px;
      padding: 10px 20px;
      margin-bottom: 10px;
    }

    #status {
      color: #555;
      margin-bottom: 10px;
    }

    #alertBox {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      color: #fff;
      z-index: 9999;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    #alertBox h1 {
      font-size: 26px;
      margin-bottom: 8px;
    }

    #alertBox p {
      font-size: 18px;
      white-space: pre-line;
    }

    #closeBtn {
      margin-top: 16px;
      font-size: 18px;
      padding: 8px 20px;
    }
  </style>
</head>

<body>

<h2>xG Alert (Live)</h2>
<p>ØªÙ†Ø¨ÙŠÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø¶ØºØ· Ù‡Ø¬ÙˆÙ…ÙŠ Ù‚ÙˆÙŠ</p>

<button id="enableSoundBtn">ğŸ”Š ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª (Ø¨Ø¹Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©)</button>
<div id="status">Ø§Ù„Ø­Ø§Ù„Ø©: Ø¨Ø§Ù†ØªØ¸Ø§Ø± ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª</div>

<div id="alertBox">
  <h1>âš½ ALERT</h1>
  <p id="alertText"></p>
  <button id="closeBtn">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<audio id="alarmSound">
  <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg">
</audio>

<script>
  /* ===== Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ===== */
  const MIN_MINUTE_XG = 30;
  const MIN_TOTAL_XG = 1.4;

  const MIN_MINUTE_SOT = 25;
  const MIN_SOT_SINGLE_TEAM = 5;

  const CHECK_EVERY_MS = 30000;

  let alerted = false;
  let soundEnabled = false;

  const sound = document.getElementById("alarmSound");
  const alertBox = document.getElementById("alertBox");
  const alertText = document.getElementById("alertText");
  const statusEl = document.getElementById("status");
  const enableSoundBtn = document.getElementById("enableSoundBtn");

  /* ===== ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª ===== */
  enableSoundBtn.onclick = () => {
    sound.play().then(() => {
      sound.pause();
      sound.currentTime = 0;
      soundEnabled = true;
      statusEl.textContent = "Ø§Ù„Ø­Ø§Ù„Ø©: Ø§Ù„ØµÙˆØª Ù…ÙØ¹Ù‘Ù„ â€“ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª";
      alert("âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª");
    });
  };

  /* ===== Ù…Ø¹Ø§Ø¯Ù„Ø© xG Ø§Ù„Ù…Ø­Ø³Ù‘Ù†Ø© ===== */
  function calcXG(shotsOnTarget, dangerousAttacks) {
    return (shotsOnTarget * 0.30) + (dangerousAttacks / 30);
  }

  /* ===== Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ø­ÙŠÙ‘Ø© ===== */
  async function fetchLiveMatches() {
    const url =
      "https://api.allorigins.win/raw?url=https://www.sofascore.com/api/v1/sport/football/events/live";
    const res = await fetch(url);
    const data = await res.json();
    return data.events || [];
  }

  async function checkMatches() {
    if (alerted) return;

    try {
      const events = await fetchLiveMatches();
      statusEl.textContent = `Ø§Ù„Ø­Ø§Ù„Ø©: ÙØ­Øµ ${events.length} Ù…Ø¨Ø§Ø±Ø§Ø© Ø­ÙŠÙ‘Ø©`;

      for (const ev of events) {
        if (!ev.statistics) continue;

        const minute = ev.time?.current || 0;

        const homeSOT = ev.statistics.home?.shotsOnTarget ?? 0;
        const awaySOT = ev.statistics.away?.shotsOnTarget ?? 0;
        const homeDA  = ev.statistics.home?.dangerousAttacks ?? 0;
        const awayDA  = ev.statistics.away?.dangerousAttacks ?? 0;

        const xgHome = calcXG(homeSOT, homeDA);
        const xgAway = calcXG(awaySOT, awayDA);
        const totalXG = xgHome + xgAway;

        /* ===== Ø´Ø±Ø· Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ===== */
        const xgCondition =
          minute >= MIN_MINUTE_XG && totalXG >= MIN_TOTAL_XG;

        const sotCondition =
          minute >= MIN_MINUTE_SOT &&
          (homeSOT >= MIN_SOT_SINGLE_TEAM ||
           awaySOT >= MIN_SOT_SINGLE_TEAM);

        if (xgCondition || sotCondition) {
          alerted = true;

          let reason = xgCondition
            ? "ğŸ“Š Ø¶ØºØ· xG Ù…Ø±ØªÙØ¹"
            : "ğŸ¯ ØªØ³Ø¯ÙŠØ¯Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ù…Ù‰ Ù…Ø±ØªÙØ¹Ø©";

          alertText.innerText =
            `${ev.homeTeam?.name} vs ${ev.awayTeam?.name}\n` +
            `Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©: ${minute}\n\n` +
            `${reason}\n\n` +
            `Shots on Target: ${homeSOT} - ${awaySOT}\n` +
            `xG: ${xgHome.toFixed(2)} - ${xgAway.toFixed(2)}\n` +
            `xG Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${totalXG.toFixed(2)}`;

          alertBox.style.display = "flex";
          if (soundEnabled) sound.play();
          break;
        }
      }
    } catch (err) {
      statusEl.textContent = "Ø§Ù„Ø­Ø§Ù„Ø©: Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
      console.error(err);
    }
  }

  setInterval(checkMatches, CHECK_EVERY_MS);

  document.getElementById("closeBtn").onclick = () => {
    alertBox.style.display = "none";
    sound.pause();
    sound.currentTime = 0;
  };
</script>

</body>
</html>
