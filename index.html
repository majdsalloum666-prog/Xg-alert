<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>xG Smart Alert</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding-top: 20px;
    }

    #enableSoundBtn {
      font-size: 18px;
      padding: 10px 20px;
      margin-bottom: 10px;
    }

    #status {
      color: #555;
      margin-bottom: 10px;
    }

    #alertBox {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.92);
      color: #fff;
      z-index: 9999;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    #alertBox h1 {
      font-size: 26px;
      margin-bottom: 8px;
    }

    #alertBox p {
      font-size: 18px;
      white-space: pre-line;
      text-align: center;
    }

    #closeBtn {
      margin-top: 16px;
      font-size: 18px;
      padding: 8px 20px;
    }
  </style>
</head>

<body>

<h2>xG Smart Alert</h2>
<p>ØªÙ†Ø¨ÙŠÙ‡ Ø°ÙƒÙŠ Ø¹Ù†Ø¯ Ø§Ù‚ØªØ±Ø§Ø¨ Ø§Ù„Ù‡Ø¯Ù (Ø¥Ø­ØµØ§Ø¦ÙŠÙ‹Ø§)</p>

<button id="enableSoundBtn">ğŸ”Š ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª</button>
<div id="status">Ø§Ù„Ø­Ø§Ù„Ø©: Ø¨Ø§Ù†ØªØ¸Ø§Ø± ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª</div>

<div id="alertBox">
  <h1>âš½ GOAL PROBABILITY HIGH</h1>
  <p id="alertText"></p>
  <button id="closeBtn">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<audio id="alarmSound">
  <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg">
</audio>

<script>
  /* ===== Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ===== */
  const MIN_MINUTE_XG_TOTAL = 30;
  const MIN_TOTAL_XG = 1.4;

  const MIN_MINUTE_SOT = 25;
  const MIN_SOT_TOTAL = 4;
  const MIN_SOT_SINGLE = 5;

  const MIN_MINUTE_XG_SINGLE = 25;
  const MIN_XG_SINGLE = 1.0;

  const CHECK_EVERY_MS = 30000;

  let alerted = false;
  let soundEnabled = false;

  const sound = document.getElementById("alarmSound");
  const alertBox = document.getElementById("alertBox");
  const alertText = document.getElementById("alertText");
  const statusEl = document.getElementById("status");
  const enableSoundBtn = document.getElementById("enableSoundBtn");

  enableSoundBtn.onclick = () => {
    sound.play().then(() => {
      sound.pause();
      sound.currentTime = 0;
      soundEnabled = true;
      statusEl.textContent = "Ø§Ù„Ø­Ø§Ù„Ø©: Ø§Ù„ØµÙˆØª Ù…ÙØ¹Ù‘Ù„ â€“ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª";
      alert("âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª");
    });
  };

  function calcXG(shotsOnTarget, dangerousAttacks) {
    return (shotsOnTarget * 0.30) + (dangerousAttacks / 30);
  }

  async function fetchLiveMatches() {
    const url =
      "https://api.allorigins.win/raw?url=https://www.sofascore.com/api/v1/sport/football/events/live";
    const res = await fetch(url);
    const data = await res.json();
    return data.events || [];
  }

  async function checkMatches() {
    if (alerted) return;

    try {
      const events = await fetchLiveMatches();
      statusEl.textContent = `Ø§Ù„Ø­Ø§Ù„Ø©: ÙØ­Øµ ${events.length} Ù…Ø¨Ø§Ø±Ø§Ø© Ø­ÙŠÙ‘Ø©`;

      for (const ev of events) {
        if (!ev.statistics) continue;

        const minute = ev.time?.current || 0;

        const homeSOT = ev.statistics.home?.shotsOnTarget ?? 0;
        const awaySOT = ev.statistics.away?.shotsOnTarget ?? 0;
        const totalSOT = homeSOT + awaySOT;

        const homeDA  = ev.statistics.home?.dangerousAttacks ?? 0;
        const awayDA  = ev.statistics.away?.dangerousAttacks ?? 0;

        const xgHome = calcXG(homeSOT, homeDA);
        const xgAway = calcXG(awaySOT, awayDA);
        const totalXG = xgHome + xgAway;

        const condXGTotal =
          minute >= MIN_MINUTE_XG_TOTAL && totalXG >= MIN_TOTAL_XG;

        const condSOTTotal =
          minute >= MIN_MINUTE_SOT && totalSOT >= MIN_SOT_TOTAL;

        const condSOTSingle =
          minute >= MIN_MINUTE_SOT &&
          (homeSOT >= MIN_SOT_SINGLE || awaySOT >= MIN_SOT_SINGLE);

        const condXGSingle =
          minute >= MIN_MINUTE_XG_SINGLE &&
          (xgHome >= MIN_XG_SINGLE || xgAway >= MIN_XG_SINGLE);

        if (condXGTotal || condSOTTotal || condSOTSingle || condXGSingle) {
          alerted = true;

          let reason =
            condXGSingle
              ? "ğŸ”¥ xG Ù„ÙØ±ÙŠÙ‚ ÙˆØ§Ø­Ø¯ â‰¥ 1.0"
              : condXGTotal
              ? "ğŸ“Š Ø¶ØºØ· xG Ù…Ø±ØªÙØ¹ (Ø¥Ø¬Ù…Ø§Ù„ÙŠ)"
              : condSOTSingle
              ? "ğŸ¯ ÙØ±ÙŠÙ‚ ÙˆØ§Ø­Ø¯ ÙŠØ³ÙŠØ·Ø± Ù‡Ø¬ÙˆÙ…ÙŠÙ‹Ø§"
              : "ğŸ¯ ØªØ³Ø¯ÙŠØ¯Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ù…Ù‰ Ù…Ø±ØªÙØ¹Ø©";

          alertText.innerText =
            `${ev.homeTeam?.name} vs ${ev.awayTeam?.name}\n\n` +
            `Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©: ${minute}\n\n` +
            `${reason}\n\n` +
            `Shots on Target: ${homeSOT} - ${awaySOT}\n` +
            `xG: ${xgHome.toFixed(2)} - ${xgAway.toFixed(2)}\n` +
            `xG Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${totalXG.toFixed(2)}`;

          alertBox.style.display = "flex";
          if (soundEnabled) sound.play();
          break;
        }
      }
    } catch (err) {
      statusEl.textContent = "Ø§Ù„Ø­Ø§Ù„Ø©: Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
      console.error(err);
    }
  }

  setInterval(checkMatches, CHECK_EVERY_MS);

  document.getElementById("closeBtn").onclick = () => {
    alertBox.style.display = "none";
    sound.pause();
    sound.currentTime = 0;
  };
</script>

</body>
</html>
